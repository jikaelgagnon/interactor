(()=>{"use strict";class e{constructor(e,t){this.senderMethod=e,this.payload=t}}class t{constructor(e){this.url=e}}class o extends t{constructor(e,t,o,n){super(n),this.activityType=e,this.createdAt=new Date,this.eventType=t.type,this.metadata=o}}class n extends t{constructor(e){super(e),this.email="Email not set",this.startTime=new Date}setEmail(e){this.email=e}}class a{update(e,t,o){this.url=t;let n=this.updateMatchData(e,o);this.selectors=this.getSelectors(n,o)}updateMatchData(e,t){let o="";const n=Object.keys(t).filter((t=>{console.log(t);const n=new URLPattern(t,e).test(this.url);return n&&t.length>o.length&&(o=t),n}));return 0===n.length&&console.log("no matches found"),this.matchPathData=t[o],n}getIDFromPage(){var e,t;return(null===(t=(e=this.matchPathData).idSelector)||void 0===t?void 0:t.call(e))||""}getSelectors(e,t){let o=[];for(const n of e){let e=t[n];if(e.selectors)for(const t of e.selectors)o.push(t)}return o}}var r,s;!function(e){e.SelfLoop="Self-Loop",e.StateChange="State Change",e.Interaction="Interaction"}(r||(r={})),function(e){e.InitializeSession="Initialize Session",e.InteractionDetection="Interaction Detection",e.NavigationDetection="Navigation Detection"}(s||(s={}));class i{constructor(e){this.StringToColor=function(){let e=null;return{next:function(t){return null===e&&(e={},e.stringToColorHash={},e.nextVeryDifferntColorIdx=0,e.veryDifferentColors=["#00FF00","#0000FF","#FF0000","#01FFFE","#FFA6FE","#FFDB66","#006401","#010067","#95003A","#007DB5","#FF00F6","#FFEEE8","#774D00","#90FB92","#0076FF","#D5FF00","#FF937E","#6A826C","#FF029D","#FE8900","#7A4782","#7E2DD2","#85A900","#FF0056","#A42400","#00AE7E","#683D3B","#BDC6FF","#263400","#BDD393","#00B917","#9E008E","#001544","#C28C9F","#FF74A3","#01D0FF","#004754","#E56FFE","#788231","#0E4CA1","#91D0CB","#BE9970","#968AE8","#BB8800","#43002C","#DEFF74","#00FFC6","#FFE502","#620E00","#008F9C","#98FF52","#7544B1","#B500FF","#00FF78","#FF6E41","#005F39","#6B6882","#5FAD4E","#A75740","#A5FFD2","#FFB167","#009BFF","#E85EBE"]),e.stringToColorHash[t]||(e.stringToColorHash[t]=e.veryDifferentColors[e.nextVeryDifferntColorIdx++],console.log(`%c The colour for ${t}`,`color: ${e.stringToColorHash[t]}`)),e.stringToColorHash[t]}}}(),this.interactionEvents=e.events?e.events:["click"],this.debug=!e.debug||e.debug,this.paths=e.paths,this.baseURL=e.baseURL,this.currentPageData=new a,this.interactionAttribute="monitoring-interactions",window.location.origin===this.baseURL?this.initializeMonitor():console.log(`Skipping monitoring. Current origin (${window.location.origin}) does not match base URL (${this.baseURL}).`)}initializeMonitor(){this.updateCurrentPageData(document.location.href),this.initializeSession(),this.bindEvents()}updateCurrentPageData(e){this.currentPageData.update(this.baseURL,e,this.paths)}initializeSession(){this.sendMessageToBackground(s.InitializeSession,this.getCurrentState())}bindEvents(){new MutationObserver(((e,t)=>this.addListenersToNewMatches())).observe(document.body,{childList:!0,subtree:!0}),navigation.addEventListener("navigate",(e=>this.onNavigationDetection(e)))}addListenersToNewMatches(){this.currentPageData.selectors.forEach((e=>{let t=document.querySelectorAll(`:is(${e.selector}):not([${this.interactionAttribute}])`),o=e.name;t.forEach((e=>{this.debug&&(e.style.border=`2px solid ${this.StringToColor.next(o)}`),e.setAttribute(this.interactionAttribute,"true");for(let t=0;t<this.interactionEvents.length;t++)e.addEventListener(this.interactionEvents[t],(t=>{this.onInteractionDetection(e,t,o)}),!0)}))}))}createStateChangeRecord(e){const t={};let n=this.currentPageData.getIDFromPage();return""!=n&&(t.id=n),new o(r.StateChange,e,t,this.currentPageData.url)}createSelfLoopRecord(e,t){const n={};let a=this.currentPageData.getIDFromPage();return""!=a&&(n.id=a),new o(r.SelfLoop,e,n,this.currentPageData.url)}createInteractionRecord(e,t,n){const a={html:e.getHTML(),name:t};let s=this.currentPageData.getIDFromPage();return""!=s&&(a.id=s),new o(r.Interaction,n,a,this.currentPageData.url)}async sendMessageToBackground(t,o){let n=new e(t,o);return await chrome.runtime.sendMessage(n)}onInteractionDetection(e,t,o){console.log(`Event detected with event type: ${t.type}`),console.log(`Event triggered by ${e}`),console.log(e.innerHTML),console.log(e.getHTML());const n=this.createInteractionRecord(e,o,t);this.sendMessageToBackground(s.InteractionDetection,n)}onNavigationDetection(e){let t=!(e.destination.url===this.currentPageData.url);if(this.currentPageData.url=e.destination.url,console.log(`Navigation detected with event type: ${e.type}`),"push"===e.navigationType){this.updateCurrentPageData(this.currentPageData.url);const t=this.createStateChangeRecord(e);this.sendMessageToBackground(s.NavigationDetection,t)}else if("replace"===e.navigationType){const o=this.createSelfLoopRecord(e,t);this.sendMessageToBackground(s.NavigationDetection,o)}}getCurrentState(){return new n(this.currentPageData.url)}}const l=JSON.parse('{"baseURL":"https://www.youtube.com","events":["pause","play","seeked","seeking","scroll","click","ended","keypress"],"paths":{"/*":{"selectors":[{"selector":"#logo-icon","name":"YouTube Logo"},{"selector":"ytm-shorts-lockup-view-model-v2","name":"Shorts on Miniplayer"},{"selector":"div#chip-shape-container, yt-tab-shape[tab-title]","name":"Category Button"},{"selector":"div#left-arrow-button","name":"Category back button"},{"selector":"div#right-arrow-button","name":"Category forward button"},{"selector":"a.yt-simple-endpoint.style-scope.ytd-guide-entry-renderer#endpoint, a.yt-simple-endpoint.style-scope.ytd-mini-guide-entry-renderer#endpoint","name":"Side Navigation Button"},{"selector":"yt-icon-button#guide-button","name":"Guide Button"},{"selector":"ytd-video-renderer, ytd-rich-item-renderer","name":"Video"},{"selector":"yt-lockup-view-model","name":"Content Collection"}]},"/":{},"/feed/*":{"selectors":[{"selector":"ytd-video-renderer[is-history]","name":"History Video"},{"selector":"ytd-grid-movie-renderer","name":"Movie Thumbnail"}]},"/channel/*":{"selectors":[{"selector":"ytd-default-promo-panel-renderer","name":"Promo Video"}]},"/@:id{/*}?":{"selectors":[{"selector":"yt-tab-shape[tab-title=\\"Home\\"]","name":"Creator Home"},{"selector":"yt-tab-shape[tab-title=\\"Videos\\"]","name":"Creator Videos"},{"selector":"yt-tab-shape[tab-title=\\"Playlists\\"]","name":"Creator Playlists"},{"selector":"yt-tab-shape[tab-title=\\"Shorts\\"]","name":"Creator Shorts"},{"selector":"yt-tab-shape[tab-title=\\"Live\\"]","name":"Creator Live"},{"selector":"yt-tab-shape[tab-title=\\"Posts\\"]","name":"Creator Posts"},{"selector":"div.yt-subscribe-button-view-model-wiz__container","name":"Creator Subscribe Button"},{"selector":"ytd-video-renderer.style-scope.ytd-channel-featured-content-renderer","name":"Creator Featured Video"},{"selector":"ytd-grid-video-renderer.style-scope.yt-horizontal-list-renderer","name":"Creator Video"}]},"/playlist?list=*":{"selectors":[{"selector":"div#content.style-scope.ytd-playlist-video-renderer","name":"Video Inside Playlist"}]},"/shorts/:id":{"selectors":[{"selector":"#like-button[is-shorts]","name":"Shorts Like Button"},{"selector":"#dislike-button[is-shorts]","name":"Shorts Dislike Button"},{"selector":"div#comments-button","name":"Comments Button"},{"selector":"ytd-player#player","name":"Shorts Video Player"}]},"/watch?v=*":{"selectors":[{"selector":"ytd-compact-video-renderer.style-scope.ytd-item-section-renderer","name":"Watch Page Recommended Video"},{"selector":"ytd-toggle-button-renderer#dislike-button","name":"Comment Dislike Button"},{"selector":"ytd-toggle-button-renderer#like-button","name":"Comment Like Button"},{"selector":"ytd-video-owner-renderer.style-scope.ytd-watch-metadata","name":"Channel Link"},{"selector":"like-button-view-model.ytLikeButtonViewModelHost","name":"Video Like Button"},{"selector":"dislike-button-view-model.ytDislikeButtonViewModelHost","name":"Video Dislike Button"},{"selector":"div#subscribe-button","name":"Subscribe Button"},{"selector":"div#player","name":"Video Player"},{"selector":"button[title=\'Share\']","name":"Share Button"}]},"/results?search_query=*":{"selectors":[{"selector":"ytd-video-renderer.style-scope.ytd-vertical-list-renderer","name":"Top Search Page Video"},{"selector":"ytd-video-renderer.style-scope.ytd-item-section-renderer","name":"Search Page Video"},{"selector":"yt-lockup-view-model.ytd-item-section-renderer","name":"Playlist"}]}}}'),c=JSON.parse('{"baseURL":"https://www.tiktok.com","events":["pause","play","seeked","seeking","scroll","click","ended","keypress"],"paths":{"/*":{"selectors":[{"selector":"a[data-e2e=\\"tiktok-logo\\"]","name":"TikTok Logo"},{"selector":"span[data-e2e=\\"like-icon\\"]","name":"Like Button"},{"selector":"span[data-e2e=\\"comment-icon\\"]","name":"Comment Button"},{"selector":"span[data-e2e=\\"share-icon\\"]","name":"Share Button"},{"selector":"button[aria-label^=\\"Add to Favorites.\\"]","name":"Share Button"},{"selector":"button[aria-label=\\"For You\\"]","name":"Home Button"},{"selector":"button[aria-label=\\"Explore\\"]","name":"Explore Button"},{"selector":"button[aria-label=\\"Following\\"]","name":"Following Button"},{"selector":"button[aria-label=\\"Upload\\"]","name":"Upload Button"},{"selector":"button[aria-label=\\"LIVE\\"]","name":"LIVE Button"},{"selector":"button[aria-label=\\"Profile\\"]","name":"Profile Button"},{"selector":"button[aria-label=\\"Search\\"]","name":"Search Button"},{"selector":"button[aria-label=\\"Friends\\"]","name":"Friends Button"},{"selector":"button[aria-label=\\"Activity\\"]","name":"Activity Button"},{"selector":"button[aria-label=\\"Messages\\"]","name":"Messages Button"},{"selector":"video","name":"Video"},{"selector":"div[data-e2e=\\"recommend-card\\"]","name":"Profile Recommendation"},{"selector":"button[data-e2e=\\"card-followbutton\\"]","name":"Profile Recommendation Follow Button"},{"selector":"a[data-e2e=\\"video-author-avatar\\"]","name":"Author Avatar"},{"selector":"button[data-e2e=\\"feed-follow\\"]","name":"Feed Follow Button"},{"selector":"button[data-e2e=\\"follow-button\\"]","name":"Profile Follow Button"},{"selector":"button[data-e2e=\\"message-button\\"]","name":"Profile Message Button"},{"selector":"button[data-e2e=\\"share-btn\\"]","name":"Profile Share Button"},{"selector":"button[aria-label=\\"Latest\\"]","name":"Profile Latest Button"},{"selector":"button[aria-label=\\"Popular\\"]","name":"Profile Popular Button"},{"selector":"button[aria-label=\\"Oldest\\"]","name":"Profile Oldest Button"},{"selector":"button[aria-label*=\\"Likes\\"]","name":"Profile Video Like Button"},{"selector":"div[data-e2e*=\\"comment-like-icon\\"], div[aria-label^=\\"Like video\\"]","name":"Comment Like Button"},{"selector":"a[data-e2e=\\"video-music\\"]","name":"Video Music Button"},{"selector":"button.css-189kgrc-ButtonCategoryItemContainer.e13i6o248, button.css-qexeba-ButtonCategoryItemContainer.e13i6o248","name":"Category Button"}]}}}'),d=JSON.parse('{"baseURL":"https://www.linkedin.com","events":["pause","play","seeked","seeking","scroll","click","ended","keypress"],"paths":{"/*":{"selectors":[{"selector":"button[aria-label^=\'React\']","name":"React Button"},{"selector":"button[aria-label=\'Comment\']","name":"Comment Button"},{"selector":"button[aria-label=\'Send in a private message\']","name":"Send Button"},{"selector":"button.social-reshare-button","name":"Repost Button"},{"selector":"button.follow","name":"Follow Button"},{"selector":"div.update-components-actor__container","name":"Profile Header"},{"selector":"button[aria-label$=\'to connect\']","name":"Connect Button"},{"selector":"button[aria-label^=\'Message\']","name":"Message Button"},{"selector":":has(> span[title^=\'Home\'])","name":"Home Button"},{"selector":":has(> span[title^=\'My network\'])","name":"My Network Button"},{"selector":":has(> span[title^=\'Jobs\'])","name":"Jobs Button"},{"selector":":has(> span[title^=\'Messaging\'])","name":"Messaging Button"},{"selector":":has(> span[title^=\'Notifications\'])","name":"Notifications Button"},{"selector":"div.feed-shared-update-v2__content","name":"Post Content"}]}}}');class u{constructor(e){this.config=e}addIDSelector(e,t){const o=this.config.paths;if(!(e in o))throw new Error("Trying to add ID selector to path that doesn't exist");o[e].idSelector=t}}new i(new u(l).config);const m=new u(c);m.addIDSelector("/*",(()=>{let e=document.querySelector("div.xgplayer-container.tiktok-web-player");return e?`https://tiktok.com/share/video/${e.id.split("-").at(-1)}`:(console.log("no url found!"),"")})),new i(m.config),new i(new u(d).config)})();