(()=>{"use strict";class e{constructor(e,t){this.senderMethod=e,this.payload=t}}class t{constructor(e){this.url=e}}class n extends t{constructor(e,t,n,o){super(o),this.type=e,this.createdAt=new Date,this.sourceState=t,this.metadata=n}}class o extends t{constructor(e){super(e),this.email="Email not set"}setEmail(e){this.email=e}}class r{update(e,t,n){this.url=t;let o=this.updateMatchData(e,n);this.selectors=this.getSelectors(o,n)}updateMatchData(e,t){let n="";const o=Object.keys(t).filter((t=>{console.log(t);const o=new URLPattern(t,e).test(this.url);return o&&t.length>n.length&&(n=t),o}));return 0===o.length&&console.log("no matches found"),this.urlUsesId=n.endsWith(":id"),this.matchPathData=t[n],o}getIDFromPage(){var e,t;return(null===(t=(e=this.matchPathData).idSelector)||void 0===t?void 0:t.call(e))||""}getSelectors(e,t){let n=[];for(const o of e){let e=t[o];for(const t of e.selectors)n.push(t)}return n}checkForMatch(e){let t=new URL(this.url).pathname,n=new URL(e).pathname,o=t.split("/"),r=n.split("/");if(t.length!==n.length)return!1;let i=o.length-(this.urlUsesId?1:0);for(let e=0;e<i;e++)if(o[e]!==r[e])return!1;return!0}}var i,a;!function(e){e.self_loop="Self-Loop",e.state_change="State Change",e.interaction="Interaction"}(i||(i={})),function(e){e.InitializeSession="Initialize Session",e.InteractionDetection="Interaction Detection",e.NavigationDetection="Navigation Detection"}(a||(a={}));class s{constructor(e){this.StringToColor=function(){let e=null;return{next:function(t){return null===e&&(e={},e.stringToColorHash={},e.nextVeryDifferntColorIdx=0,e.veryDifferentColors=["#00FF00","#0000FF","#FF0000","#01FFFE","#FFA6FE","#FFDB66","#006401","#010067","#95003A","#007DB5","#FF00F6","#FFEEE8","#774D00","#90FB92","#0076FF","#D5FF00","#FF937E","#6A826C","#FF029D","#FE8900","#7A4782","#7E2DD2","#85A900","#FF0056","#A42400","#00AE7E","#683D3B","#BDC6FF","#263400","#BDD393","#00B917","#9E008E","#001544","#C28C9F","#FF74A3","#01D0FF","#004754","#E56FFE","#788231","#0E4CA1","#91D0CB","#BE9970","#968AE8","#BB8800","#43002C","#DEFF74","#00FFC6","#FFE502","#620E00","#008F9C","#98FF52","#7544B1","#B500FF","#00FF78","#FF6E41","#005F39","#6B6882","#5FAD4E","#A75740","#A5FFD2","#FFB167","#009BFF","#E85EBE"]),e.stringToColorHash[t]||(e.stringToColorHash[t]=e.veryDifferentColors[e.nextVeryDifferntColorIdx++],console.log(`%c The colour for ${t}`,`color: ${e.stringToColorHash[t]}`)),e.stringToColorHash[t]}}}(),this.interactionEvents=e.interactionEvents?e.interactionEvents:["click"],this.debug=!e.debug||e.debug,this.paths=e.paths,this.baseURL=e.baseURL,this.currentPageData=new r,this.interactionAttribute="monitoring-interactions",window.location.origin===this.baseURL?this.initializeMonitor():console.log(`Skipping monitoring. Current origin (${window.location.origin}) does not match base URL (${this.baseURL}).`)}initializeMonitor(){this.updateCurrentPageData(document.location.href),this.initializeSession(),this.bindEvents()}updateCurrentPageData(e){this.currentPageData.update(this.baseURL,e,this.paths)}initializeSession(){this.sendMessageToBackground(a.InitializeSession,this.getCurrentState())}bindEvents(){new MutationObserver(((e,t)=>this.addListenersToNewMatches())).observe(document.body,{childList:!0,subtree:!0}),navigation.addEventListener("navigate",(e=>this.onNavigationDetection(e)))}addListenersToNewMatches(){this.currentPageData.selectors.forEach((e=>{let t=document.querySelectorAll(e.selector+`:not([${this.interactionAttribute}]`),n=e.name;t.forEach((e=>{this.debug&&(e.style.border=`2px solid ${this.StringToColor.next(n)}`),e.setAttribute(this.interactionAttribute,"true");for(let t=0;t<this.interactionEvents.length;t++)e.addEventListener(this.interactionEvents[t],(e=>{this.onInteractionDetection(e,n)}),!0)}))}))}createStateChangeRecord(e,t){const o={destinationState:t};let r=this.currentPageData.getIDFromPage();return""!=r&&(o.id=r),new n(i.state_change,e,o,this.currentPageData.url)}createSelfLoopRecord(e,t){const o={urlChange:t};let r=this.currentPageData.getIDFromPage();return""!=r&&(o.id=r),new n(i.self_loop,e,o,this.currentPageData.url)}createInteractionRecord(e,t){const o={name:e};let r=this.currentPageData.getIDFromPage();return""!=r&&(o.id=r),new n(i.interaction,t,o,this.currentPageData.url)}sendMessageToBackground(t,n){return o=this,r=void 0,a=function*(){let o=new e(t,n);return yield chrome.runtime.sendMessage(o)},new((i=void 0)||(i=Promise))((function(e,t){function n(e){try{c(a.next(e))}catch(e){t(e)}}function s(e){try{c(a.throw(e))}catch(e){t(e)}}function c(t){var o;t.done?e(t.value):(o=t.value,o instanceof i?o:new i((function(e){e(o)}))).then(n,s)}c((a=a.apply(o,r||[])).next())}));var o,r,i,a}onInteractionDetection(e,t){const n=this.createInteractionRecord(t,this.getCleanStateName());this.sendMessageToBackground(a.InteractionDetection,n)}onNavigationDetection(e){let t=!(e.destination.url===this.currentPageData.url),n=this.getCleanStateName(),o=this.currentPageData.checkForMatch(e.destination.url);this.currentPageData.url=e.destination.url;let r=this.getCleanStateName();if("push"!==e.navigationType||o){if("replace"===e.navigationType||o){const e=this.createSelfLoopRecord(n,t);this.sendMessageToBackground(a.NavigationDetection,e)}}else{this.updateCurrentPageData(this.currentPageData.url);const e=this.createStateChangeRecord(n,r);this.sendMessageToBackground(a.NavigationDetection,e)}}getCleanStateName(){let e=new URL(this.currentPageData.url).pathname.split("/");return this.currentPageData.urlUsesId&&(e=e.slice(0,e.length-1)),e.join("/")}getCurrentState(){return new o(this.currentPageData.url)}}const c=JSON.parse('{"baseURL":"https://www.youtube.com","paths":{"/*":{"selectors":[{"selector":"#endpoint","name":"Side Navigation Button"},{"selector":"#logo-icon","name":"YouTube Logo"},{"selector":"ytd-rich-item-renderer.style-scope.ytd-rich-grid-renderer","name":"Video"},{"selector":"ytm-shorts-lockup-view-model-v2","name":"Shorts on Miniplayer"},{"selector":".yt-spec-button-shape-next[aria-label=\\"Next\\"]","name":"Next Button"},{"selector":"#chip-container.style-scope.yt-chip-cloud-chip-renderer","name":"Category Button"}]},"/shorts/:id":{"selectors":[{"selector":"#like-button[is-shorts]","name":"Shorts Like Button"},{"selector":"#dislike-button[is-shorts]","name":"Shorts Dislike Button"}]},"/watch?v=*":{"selectors":[{"selector":"ytd-compact-video-renderer.style-scope.ytd-item-section-renderer","name":"Watch Page Recommended Video"},{"selector":"ytd-toggle-button-renderer#dislike-button","name":"Comment Dislike Button"},{"selector":"ytd-toggle-button-renderer#like-button","name":"Comment Like Button"},{"selector":"ytd-video-owner-renderer.style-scope.ytd-watch-metadata","name":"Channel Link"},{"selector":"like-button-view-model.ytLikeButtonViewModelHost","name":"Video Like Button"},{"selector":"dislike-button-view-model.ytDislikeButtonViewModelHost","name":"Video Like Button"}]},"/results?search_query=*":{"selectors":[{"selector":"ytd-video-renderer.style-scope.ytd-vertical-list-renderer","name":"Top Search Page Video"},{"selector":"ytd-video-renderer.style-scope.ytd-item-section-renderer","name":"Search Page Video"},{"selector":"yt-lockup-view-model.ytd-item-section-renderer","name":"Playlist"}]}}}'),l=JSON.parse('{"baseURL":"https://www.tiktok.com","paths":{"/*":{"selectors":[{"selector":"a[data-e2e=\\"tiktok-logo\\"]","name":"TikTok Logo"},{"selector":"span[data-e2e=\\"like-icon\\"]","name":"Like Button"},{"selector":"span[data-e2e=\\"comment-icon\\"]","name":"Comment Button"},{"selector":"button[aria-label=\\"For You\\"]","name":"Home Button"},{"selector":"button[aria-label=\\"Explore\\"]","name":"Explore Button"},{"selector":"button[aria-label=\\"Following\\"]","name":"Following Button"}]}}}');class u{constructor(e){this.config=e}addIDSelector(e,t){const n=this.config.paths;if(!(e in n))throw new Error("Trying to add ID selector to path that doesn't exist");n[e].idSelector=t}}new s(new u(c).config),console.log(l);const h=new u(l);h.addIDSelector("/*",(()=>{let e=document.querySelector("div.xgplayer-container.tiktok-web-player");return e?`https://tiktok.com/share/video/${e.id.split("-").at(-1)}`:(console.log("no url found!"),"")})),new s(h.config)})();